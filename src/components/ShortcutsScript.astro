<script defer>
    (() => {
        const mac =
            /(macintosh|macintel|macppc|mac68k|macos)/i.test(
                navigator.userAgent
            ) ||
            (navigator.platform &&
                /(mac|iphone|ipod|ipad)/i.test(navigator.platform));

        const ctrl = mac ? "⌃" : "Ctrl";
        const option = mac ? "⌥" : "Alt";
        const shift = mac ? "⇧" : "Shift";

        const shortcutedElements = document.querySelectorAll("[data-shortcut]");
        const shortcutedElementsArray = Array.from(shortcutedElements);
        const registeredShortcuts = [];

        for (let i = 0; i < shortcutedElementsArray.length; i++) {
            const element = shortcutedElementsArray[i];
            const shortcut = element.getAttribute("data-shortcut");

            const keys = shortcut.split("+");

            const tooltip = keys
                .map((key) => {
                    switch (key) {
                        case "ctrl":
                            return ctrl;
                        case "shift":
                            return "⇧";
                        case "option":
                            return option;
                        default:
                            return key;
                    }
                })
                .join(" ");

            const tooltipElement = document.createElement("span");
            tooltipElement.classList.add("tooltip");
            tooltipElement.innerText = tooltip;
            element.appendChild(tooltipElement);

            registeredShortcuts.push({
                keys: keys.map((key) =>
                    key
                        .replace(/^[0-9]$/, (num) => "digit" + num)
                        .replace(
                            /^[a-z]$/i,
                            (letter) => "key" + letter.toLowerCase()
                        )
                ),
                element,
            });
        }

        window.addEventListener("keydown", (event) => {
            const { code, ctrlKey, altKey, shiftKey } = event;

            const pressedKeys = new Set();

            if (event.ctrlKey) {
                pressedKeys.add("ctrl");
            }

            if (event.altKey) {
                pressedKeys.add("option");
            }

            if (event.shiftKey) {
                pressedKeys.add("shift");
            }

            pressedKeys.add(code.toLowerCase());

            const shortcut = registeredShortcuts.find((shortcut) => {
                return (
                    shortcut.keys.length === pressedKeys.size &&
                    shortcut.keys.every((key) => pressedKeys.has(key))
                );
            });

            if (shortcut) {
                shortcut.element.click();
            }
        });
    })();
</script>

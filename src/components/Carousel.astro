---
export interface Props {
    srcset: Array<string>;
    timeout: number;
}

const srcset = Astro.props.srcset;
const json = JSON.stringify(srcset);
---

<img
    loading="lazy"
    decoding="async"
    src={Astro.props.srcset[0]}
    data-srcset={json}
    onload={[
        'if (this.dataset.status === "loaded") { return }',
        'this.dataset.status = "loaded"',
        "const srcset = JSON.parse(this.dataset.srcset)",
        "let i = 0",
        "const t = window.setInterval(() => {",
        "this.src = srcset[i]",
        `i = (i + 1) % ${srcset.length}`,
        `}, ${Astro.props.timeout})`,
    ].join(";")}
    style={{
        width: "1.5em",
        height: "1.5em",
        objectFit: "contain",
        display: "inline-block",
    }}
/>
